<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>鍵盤按鍵診斷工具 - 免費線上按鍵測試</title>
<meta name="description" content="免費線上鍵盤診斷工具，快速檢測鍵盤按鍵功能。支援計數、故障標記、深淺主題切換，幫助您測試和診斷鍵盤問題。">
<meta name="keywords" content="鍵盤測試,按鍵診斷,鍵盤檢測,線上工具,免費檢測">
<meta name="author" content="Keyboard Test Tool">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:title" content="鍵盤按鍵診斷工具 - 免費線上按鍵測試">
<meta property="og:description" content="免費線上鍵盤診斷工具，快速檢測鍵盤按鍵功能。支援計數、故障標記、深淺主題切換。">
<meta property="og:type" content="website">
<meta property="og:url" content="https://keyboard.ouoc.net/">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="鍵盤按鍵診斷工具">
<meta name="twitter:description" content="免費線上鍵盤診斷工具，快速檢測鍵盤按鍵功能。">
<link rel="canonical" href="https://keyboard.ouoc.net/">
<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
<meta name="language" content="zh-TW">
<style>
  :root {
    --bg: #f5f5f7;
    --text: #1d1d1f;
    --muted: #6e6e73;
    --key-bg: #ffffff;
    --key-text: #000000;
    --key-shadow: 0 1px 3px rgba(0,0,0,0.12);
    --accent: #0071e3;
    --container-bg: #ffffff;
    --container-shadow: 0 10px 30px rgba(0,0,0,0.08);
    --btn-border: rgba(0,0,0,0.08);
  }

  /* 手動覆寫主題：設定 data-theme="light" 或 data-theme="dark" 在 <html> 上 */
  html[data-theme="light"] {
    --bg: #f5f5f7;
    --text: #1d1d1f;
    --muted: #6e6e73;
    --container-bg: #ffffff;
    /* 亮色模式的鍵盤容器陰影：更柔、更淺 */
    --container-shadow: 0 8px 24px rgba(16,24,40,0.06);
    --btn-border: rgba(0,0,0,0.08);
    --key-bg: #ffffff;
    --key-text: #000000;
    --key-shadow: 0 1px 3px rgba(16,24,40,0.06);
  }

  html[data-theme="dark"] {
    --bg: #1c1c1e;
    --text: #f5f5f7;
    --muted: #9b9b9f;
    --container-bg: #000000;
    --container-shadow: 0 20px 50px rgba(0,0,0,0.6);
    --btn-border: rgba(255,255,255,0.08);
    --key-bg: #2c2c2e;
    --key-text: #f5f5f7;
    --key-shadow: 0 1px 6px rgba(0,0,0,0.6);
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --bg: #1c1c1e;
      --text: #f5f5f7;
      --muted: #9b9b9f;
      --key-bg: #2c2c2e;
      --key-text: #f5f5f7;
      --key-shadow: 0 1px 6px rgba(0,0,0,0.6);
      --container-bg: #000000;
      --container-shadow: 0 20px 50px rgba(0,0,0,0.6);
    }
  }

  body {
    margin: 0;
    padding: 40px 20px;
    background: var(--bg);
    color: var(--text);
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", Helvetica, Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }

  h1 {
    font-size: 32px;
    font-weight: 700;
    margin: 0 0 8px 0;
  }
  .desc {
    font-size: 17px;
    color: var(--muted);
    margin-bottom: 32px;
  }

  .toolbar {
    display: flex;
    gap: 12px;
    align-items: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  #resetBtn {
    background: var(--accent);
    color: white;
    border: none;
    border-radius: 12px;
    padding: 10px 24px;
    font-size: 17px;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,113,227,0.3);
    transition: all 0.2s ease;
    margin: 0;
  }
  #resetBtn:hover { background: #0060c8; }
  #resetBtn:active { transform: scale(0.98); }

  /* 主題切換按鈕 */
  #themeToggleBtn {
    background: transparent;
    color: var(--text);
    border: 1px solid var(--btn-border);
    border-radius: 12px;
    padding: 10px 24px;
    font-size: 17px;
    font-weight: 600;
    cursor: pointer;
  }
  #themeToggleBtn:active { transform: translateY(1px); }

  /* 佈局下拉 */
  #layoutSelect {
    border: 1px solid var(--btn-border);
    border-radius: 10px;
    padding: 10px 12px;
    font-size: 16px;
    background: var(--container-bg);
    color: var(--text);
  }

  .keyboard-container {
    background: var(--container-bg);
    padding: 20px 18px 28px;
    border-radius: 24px;
    box-shadow: var(--container-shadow);
  }

  .row {
    display: flex;
    gap: 8px;
    justify-content: center;
    margin-bottom: 8px;
  }

  .key {
    position: relative;
    background: var(--key-bg);
    color: var(--key-text);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 15px;
    font-weight: 500;
    box-shadow: var(--key-shadow);
    transition: all 0.15s ease;
    user-select: none;
    cursor: pointer;
  }

  /* 按下動畫 */
  .key:active, .key.pressed {
    transform: translateY(2px);
  }

  /* 計數徽章（右上角） */
  .badge {
    position: absolute;
    top: -10px;
    right: -10px;
    min-width: 28px;
    height: 28px;
    border-radius: 14px;
    background: #34c759;
    color: white;
    font-size: 14px;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
  }
  .badge.green { background: #34c759; color: white; }
  .badge.yellow { background: #ffcc00; color: black; }
  .badge.red    { background: #ff3b30; animation: pulse 2s infinite; }

  /* 紅色驚嘆號（左上角） */
  .warning {
    position: absolute;
    top: -8px;
    left: -8px;
    width: 32px;
    height: 32px;
    background: #ff3b30;
    color: white;
    border-radius: 50%;
    font-size: 20px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(255,59,48,0.5);
    animation: pop 0.3s ease;
  }

  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
  }
  @keyframes pop {
    0% { transform: scale(0); }
    80% { transform: scale(1.2); }
    100% { transform: scale(1); }
  }

  /* 按鍵尺寸 */
  .key { height: 56px; width: 56px; }
  .w15  { width: calc(56px * 1.5); }
  .w175 { width: calc(56px * 1.75); }
  .w225 { width: calc(56px * 2.25); }
  .w625 { width: calc(56px * 6.25); }
  .w7   { width: calc(56px * 7); }
  .return { border-radius: 0 12px 12px 0; }
</style>
</head>
<body>

<main>
<h1>鍵盤按鍵診斷工具</h1>
<p class="desc">點擊按鍵標記問題（紅色驚嘆號），或用實體鍵盤測試次數</p>
<div class="toolbar">
  <button id="resetBtn" aria-label="重設所有按鍵計數與標記">重設所有計數與標記</button>
  <button id="themeToggleBtn" aria-pressed="false" aria-label="切換深淺主題">主題：系統</button>
  <label for="layoutSelect" style="display:flex;align-items:center;gap:8px;font-weight:600;color:var(--text);">
    佈局
    <select id="layoutSelect" aria-label="選擇鍵盤佈局">
      <option value="mac">Mac (ANSI)</option>
      <option value="win">Windows (ANSI)</option>
    </select>
  </label>
</div>

<section class="keyboard-container" aria-label="鍵盤按鍵診斷區域">
  <div id="keyboard"></div>
</section>

</main>

<script>
const layouts = {
  mac: {
    name: 'Mac (ANSI)',
    rows: [
      [
        { label: 'esc', key: 'Escape' },
        { label: 'F1', key: 'F1' },
        { label: 'F2', key: 'F2' },
        { label: 'F3', key: 'F3' },
        { label: 'F4', key: 'F4' },
        { label: 'F5', key: 'F5' },
        { label: 'F6', key: 'F6' },
        { label: 'F7', key: 'F7' },
        { label: 'F8', key: 'F8' },
        { label: 'F9', key: 'F9' },
        { label: 'F10', key: 'F10' },
        { label: 'F11', key: 'F11' },
        { label: 'F12', key: 'F12' },
      ],
      [
        { label: '`', key: '`' },
        { label: '1', key: '1' },
        { label: '2', key: '2' },
        { label: '3', key: '3' },
        { label: '4', key: '4' },
        { label: '5', key: '5' },
        { label: '6', key: '6' },
        { label: '7', key: '7' },
        { label: '8', key: '8' },
        { label: '9', key: '9' },
        { label: '0', key: '0' },
        { label: '−', key: '-' },
        { label: '=', key: '=' },
        { label: 'delete', key: 'Backspace', width: 'w175' },
      ],
      [
        { label: 'Tab', key: 'Tab', width: 'w15' },
        { label: 'Q', key: 'q' },
        { label: 'W', key: 'w' },
        { label: 'E', key: 'e' },
        { label: 'R', key: 'r' },
        { label: 'T', key: 't' },
        { label: 'Y', key: 'y' },
        { label: 'U', key: 'u' },
        { label: 'I', key: 'i' },
        { label: 'O', key: 'o' },
        { label: 'P', key: 'p' },
        { label: '[', key: '[' },
        { label: ']', key: ']' },
        { label: '\\', key: '\\', width: 'w15' },
      ],
      [
        { label: 'Caps Lock', key: 'CapsLock', width: 'w175' },
        { label: 'A', key: 'a' },
        { label: 'S', key: 's' },
        { label: 'D', key: 'd' },
        { label: 'F', key: 'f' },
        { label: 'G', key: 'g' },
        { label: 'H', key: 'h' },
        { label: 'J', key: 'j' },
        { label: 'K', key: 'k' },
        { label: 'L', key: 'l' },
        { label: ';', key: ';' },
        { label: "'", key: "'" },
        { label: 'return', key: 'Enter', width: 'w225', extraClass: 'return' },
      ],
      [
        { label: 'Shift', key: 'Shift', width: 'w225' },
        { label: 'Z', key: 'z' },
        { label: 'X', key: 'x' },
        { label: 'C', key: 'c' },
        { label: 'V', key: 'v' },
        { label: 'B', key: 'b' },
        { label: 'N', key: 'n' },
        { label: 'M', key: 'm' },
        { label: ',', key: ',' },
        { label: '.', key: '.' },
        { label: '/', key: '/' },
        { label: 'Shift', key: 'ShiftR', width: 'w225' },
      ],
      [
        { label: 'fn', key: 'fn', width: 'w15' },
        { label: 'control', key: 'Control', width: 'w15' },
        { label: 'option', key: 'Alt', width: 'w15' },
        { label: 'command', key: 'Meta', width: 'w15' },
        { label: 'Space', key: ' ', width: 'w7' },
        { label: 'command', key: 'MetaR', width: 'w15' },
        { label: 'option', key: 'AltR', width: 'w15' },
        { label: 'Left', key: 'ArrowLeft' },
        { stack: [
            { label: 'Up', key: 'ArrowUp' },
            { label: 'Down', key: 'ArrowDown' },
          ]
        },
        { label: 'Right', key: 'ArrowRight' },
      ],
    ],
  },
  win: {
    name: 'Windows (ANSI)',
    rows: [
      [
        { label: 'esc', key: 'Escape' },
        { label: 'F1', key: 'F1' },
        { label: 'F2', key: 'F2' },
        { label: 'F3', key: 'F3' },
        { label: 'F4', key: 'F4' },
        { label: 'F5', key: 'F5' },
        { label: 'F6', key: 'F6' },
        { label: 'F7', key: 'F7' },
        { label: 'F8', key: 'F8' },
        { label: 'F9', key: 'F9' },
        { label: 'F10', key: 'F10' },
        { label: 'F11', key: 'F11' },
        { label: 'F12', key: 'F12' },
      ],
      [
        { label: '`', key: '`' },
        { label: '1', key: '1' },
        { label: '2', key: '2' },
        { label: '3', key: '3' },
        { label: '4', key: '4' },
        { label: '5', key: '5' },
        { label: '6', key: '6' },
        { label: '7', key: '7' },
        { label: '8', key: '8' },
        { label: '9', key: '9' },
        { label: '0', key: '0' },
        { label: '-', key: '-' },
        { label: '=', key: '=' },
        { label: 'Backspace', key: 'Backspace', width: 'w175' },
      ],
      [
        { label: 'Tab', key: 'Tab', width: 'w15' },
        { label: 'Q', key: 'q' },
        { label: 'W', key: 'w' },
        { label: 'E', key: 'e' },
        { label: 'R', key: 'r' },
        { label: 'T', key: 't' },
        { label: 'Y', key: 'y' },
        { label: 'U', key: 'u' },
        { label: 'I', key: 'i' },
        { label: 'O', key: 'o' },
        { label: 'P', key: 'p' },
        { label: '[', key: '[' },
        { label: ']', key: ']' },
        { label: '\\', key: '\\', width: 'w15' },
      ],
      [
        { label: 'Caps Lock', key: 'CapsLock', width: 'w175' },
        { label: 'A', key: 'a' },
        { label: 'S', key: 's' },
        { label: 'D', key: 'd' },
        { label: 'F', key: 'f' },
        { label: 'G', key: 'g' },
        { label: 'H', key: 'h' },
        { label: 'J', key: 'j' },
        { label: 'K', key: 'k' },
        { label: 'L', key: 'l' },
        { label: ';', key: ';' },
        { label: "'", key: "'" },
        { label: 'Enter', key: 'Enter', width: 'w225', extraClass: 'return' },
      ],
      [
        { label: 'Shift', key: 'Shift', width: 'w225' },
        { label: 'Z', key: 'z' },
        { label: 'X', key: 'x' },
        { label: 'C', key: 'c' },
        { label: 'V', key: 'v' },
        { label: 'B', key: 'b' },
        { label: 'N', key: 'n' },
        { label: 'M', key: 'm' },
        { label: ',', key: ',' },
        { label: '.', key: '.' },
        { label: '/', key: '/' },
        { label: 'Shift', key: 'ShiftR', width: 'w225' },
      ],
      [
        { label: 'Ctrl', key: 'Control', width: 'w15' },
        { label: 'Win', key: 'Meta', width: 'w15' },
        { label: 'Alt', key: 'Alt', width: 'w15' },
        { label: 'Space', key: ' ', width: 'w7' },
        { label: 'AltGr', key: 'AltR', width: 'w15' },
        { label: 'Menu', key: 'ContextMenu', width: 'w15' },
        { label: 'Ctrl', key: 'ControlR', width: 'w15' },
        { label: 'Left', key: 'ArrowLeft' },
        { stack: [
            { label: 'Up', key: 'ArrowUp' },
            { label: 'Down', key: 'ArrowDown' },
          ]
        },
        { label: 'Right', key: 'ArrowRight' },
      ],
    ],
  }
};

const counter = {};
const warned = new Set(); // 儲存有問題的按鍵
const keyboardEl = document.getElementById('keyboard');
const layoutSelect = document.getElementById('layoutSelect');

function createKeyElement(keyDef) {
  const el = document.createElement('div');
  el.className = ['key', keyDef.width, keyDef.extraClass].filter(Boolean).join(' ');
  el.dataset.key = keyDef.key;
  el.textContent = keyDef.label;
  return el;
}

function renderKeyboard(layoutName) {
  const layout = layouts[layoutName] || layouts.mac;
  keyboardEl.innerHTML = '';
  layout.rows.forEach(row => {
    const rowEl = document.createElement('div');
    rowEl.className = 'row';
    row.forEach(keyDef => {
      if (keyDef.stack) {
        const wrapper = document.createElement('div');
        wrapper.className = 'key';
        wrapper.style.display = 'flex';
        wrapper.style.flexDirection = 'column';
        wrapper.style.gap = '2px';
        keyDef.stack.forEach(stackKey => {
          const child = createKeyElement(stackKey);
          wrapper.appendChild(child);
        });
        rowEl.appendChild(wrapper);
      } else {
        const keyEl = createKeyElement(keyDef);
        rowEl.appendChild(keyEl);
      }
    });
    keyboardEl.appendChild(rowEl);
  });
}

function initKeyInteractions() {
  document.querySelectorAll('.key[data-key]').forEach(keyEl => {
    const key = keyEl.dataset.key;

    // 計數徽章
    const badge = document.createElement('div');
    badge.className = 'badge green';
    badge.textContent = '0';
    keyEl.appendChild(badge);

    // 點擊切換警告標記
    keyEl.addEventListener('click', (e) => {
      e.stopPropagation();
      if (warned.has(key)) {
        warned.delete(key);
        keyEl.querySelector('.warning')?.remove();
      } else {
        warned.add(key);
        const warn = document.createElement('div');
        warn.className = 'warning';
        warn.textContent = '!';
        keyEl.appendChild(warn);
      }
    });
  });
}

function resetAll() {
  Object.keys(counter).forEach(k => delete counter[k]);
  warned.clear();
  document.querySelectorAll('.badge').forEach(b => {
    b.textContent = '0';
    b.className = 'badge green';
  });
  document.querySelectorAll('.warning').forEach(w => w.remove());
}

// 實體鍵盤輸入（只計數，不影響標記）
document.addEventListener('keydown', e => {
  e.preventDefault();
  let key = e.key;
  if (key === ' ') key = ' ';
  if (e.key === 'Meta') key = e.location === 1 ? 'Meta' : 'MetaR';
  if (e.key === 'Alt') key = e.location === 1 ? 'Alt' : 'AltR';
  if (e.key === 'AltGraph') key = 'AltR';
  if (e.key === 'Shift') key = e.location === 1 ? 'Shift' : 'ShiftR';
  if (e.key === 'Control') key = e.location === 1 ? 'Control' : 'ControlR';
  if (e.key === 'ContextMenu') key = 'ContextMenu';

  const el = document.querySelector(`[data-key="${key}"]`);
  if (el) {
    counter[key] = (counter[key] || 0) + 1;
    const badge = el.querySelector('.badge');
    badge.textContent = counter[key];
    badge.classList.remove('green','yellow','red');
    if (counter[key] >= 6) badge.classList.add('red');
    else if (counter[key] >= 3) badge.classList.add('yellow');
    else badge.classList.add('green');

    // 按下動畫
    el.classList.add('pressed');
    setTimeout(() => el.classList.remove('pressed'), 150);
  }
});

// 佈局切換
layoutSelect.addEventListener('change', () => {
  const choice = layoutSelect.value;
  localStorage.setItem('layout', choice);
  renderKeyboard(choice);
  initKeyInteractions();
  resetAll();
});

// 初始化佈局
const savedLayout = localStorage.getItem('layout');
const initialLayout = layouts[savedLayout] ? savedLayout : 'mac';
layoutSelect.value = initialLayout;
renderKeyboard(initialLayout);
initKeyInteractions();
resetAll();

// 重設按鈕
document.getElementById('resetBtn').addEventListener('click', () => {
  resetAll();
});

// 主題切換與偏好儲存
(function(){
  const btn = document.getElementById('themeToggleBtn');
  const root = document.documentElement;

  function effectiveTheme(){
    const stored = localStorage.getItem('theme');
    if(stored === 'light' || stored === 'dark') return stored;
    return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
  }

  function applyTheme(choice){
    if(choice === 'system' || !choice){
      root.removeAttribute('data-theme');
      btn.textContent = '主題：系統';
      btn.setAttribute('aria-pressed','false');
    } else {
      root.setAttribute('data-theme', choice);
      btn.textContent = choice === 'dark' ? '主題：深色' : '主題：亮色';
      btn.setAttribute('aria-pressed', 'true');
    }
  }

  // 初始化：若有儲存偏好則套用，否則維持系統（顯示目前狀態）
  const stored = localStorage.getItem('theme');
  if(stored === 'light' || stored === 'dark') applyTheme(stored);
  else applyTheme('system');

  // 點擊切換：如果目前是系統或亮色，切為深色；若是深色則切為亮色
  btn.addEventListener('click', ()=>{
    const current = root.getAttribute('data-theme') || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    const next = current === 'dark' ? 'light' : 'dark';
    applyTheme(next);
    localStorage.setItem('theme', next);
  });

  // 若使用者想回到「系統」，按住 shift + 點擊
  btn.addEventListener('click', (e)=>{
    if(e.shiftKey){
      localStorage.removeItem('theme');
      applyTheme('system');
    }
  });
})();
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "鍵盤按鍵診斷工具",
  "description": "免費線上鍵盤診斷工具，快速檢測鍵盤按鍵功能。支援計數、故障標記、深淺主題切換。",
  "url": "https://keyboard.ouoc.net/",
  "applicationCategory": "Utility",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "author": {
    "@type": "Organization",
    "name": "Keyboard Test"
  }
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "如何使用鍵盤診斷工具？",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "直接按下您的鍵盤按鍵，工具會自動計數並顯示次數。點擊螢幕上的按鍵可標記有問題的按鍵。"
      }
    },
    {
      "@type": "Question",
      "name": "計數器顯示什麼顏色的徽章？",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "綠色表示正常（0-2次），黃色表示有些頻繁（3-5次），紅色表示可能有問題（6次或以上）。"
      }
    }
  ]
}
</script>

</body>
</html>